$(function(){$(".dropdown-toggle").click(function(){$(this).next(".dropdown").toggle()}),$(document).click(function(t){var e=t.target;$(e).is(".dropdown-toggle")||$(e).parents().is(".dropdown-toggle")||$(".dropdown").hide()})});var taskProjectApp=angular.module("taskProjectApp",["ngCookies","angular.filter","infinite-scroll"]);taskProjectApp.controller("TaskProjectCtrl",["$scope","$http","$cookies","$filter",function(t,e,s,o){t.taskPageCount=0,t.page=1,t.busy=!1,t.showBlockProjects=!1,t.showBlockTask=!1,t.showBlockEditProjects=!1,t.showBlockTask=!1,t.isProjectEdit=!1,t.isTaskEdit=!1,t.currentDate=new Date,t.currentTimeZone=(new Date).toString().split("(")[1].slice(0,-1);var a,i=s.get("session");t.activeClass=function(e){return e===t.activeProject?"active":""},getSession=function(){e({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(t){return s.put("session",t.data.session),i=t.data.session,checkSession(),t.data.session},function(t){})},checkSession=function(){e({method:"GET",url:"https://api-test-task.decodeapps.io/session?session="+i}).then(function(e){if("OK"==e.statusText)t.preloader={display:"block"},getUser(i),getProjects(i,!1);else{var s=getSession();getUser(s),getProjects(i,!1)}},function(t){})},t.init=function(){var t=s.get("session");void 0==t?getSession():checkSession()},getUser=function(s){e({method:"GET",url:"https://api-test-task.decodeapps.io/account?session="+s}).then(function(e){t.userAvatar=e.data.Account.image_url,t.name=e.data.Account.username},function(t){})},getProjects=function(s,o){e({method:"GET",url:"https://api-test-task.decodeapps.io/projects?session="+s}).then(function(e){t.projects=e.data.projects,o||(t.activeProject=e.data.projects[0].Project.id,t.projectTitle=e.data.projects[0].Project.title),getTasks(s,t.activeProject,10,0,null)},function(t){})},createProject=function(s,o){e({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:s,Project:{title:o}}}).then(function(e){(e.status=200)&&(getProjects(s,!0),t.closeProjectPage(),t.activeProject=e.data.Project.id,t.projectTitle=o,t.closeEditProjectPage())},function(t){})},editProject=function(s,o,i){e({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:s,Project:{id:o,title:i}}}).then(function(e){(e.statusText="OK")&&(getProjects(s,!0),t.activeProject=e.data.Project.id,a=e.data.Project.title,t.closeEditProjectPage(),getProjects(s,!0),t.closeEditProjectPage(),t.activeProject=e.data.Project.id,t.activeProjectName=e.data.Project.title)},function(t){})},deleteThisProject=function(t,s){e({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project?session="+t+"&project_id="+s}).then(function(e){(e.status=200)&&getProjects(t,!1)},function(t){})},getTasks=function(s,a,i,c,n){var r="https://api-test-task.decodeapps.io/tasks?session="+s+"&project_id="+a+"&paging_size="+i+"&paging_offset="+c;null!=n&&(r=r+"&condition_keywords="+n),e({method:"GET",url:r}).then(function(e){t.taskPageCount=Math.ceil(e.data.total_count/10),t.tasks=[],t.tasksCount=e.data.tasks.length,void 0!=t.tasksCount&&angular.forEach(e.data.tasks,function(e,s){var a,i=o("date")(t.currentDate,"EEEE '('MM.dd.yyyy')'","+0900"),c=o("date")(new Date(e.Task.created_at),"EEEE '('MM.dd.yyyy')'",t.currentTimeZone),n=new Date(t.currentDate.getTime()-864e5),r=o("date")(n,"EEEE '('MM.dd.yyyy')'","+0900");a=i==c?"Today":r==c?"Yesterday":c;var d={Task:{id:e.Task.id,title:e.Task.title,description:e.Task.description,created_at:a}};t.tasks.push(d)}),t.preloader={display:"none"}},function(t){})},compliteTask=function(s,o){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task/complite",data:{session:s,Task:{id:o}}}).then(function(e){(e.status=200)&&(getTasks(s,t.activeProject,10,0,null),getProjects(s,!0))},function(t){})},createTask=function(s,o,a,i){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:s,Project:{id:o},Task:{title:a,description:i}}}).then(function(e){if(e.status=201){var s={Task:{id:e.data.Task.id,title:a,description:i,created_at:"Today"}};t.tasks.push(s),t.tasksCount=t.tasks.length,angular.forEach(t.projects,function(e,s){e.Project.id==t.activeProject&&e.Project.task_count++})}},function(t){})},editThisTask=function(s,o,a,i){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:s,Task:{id:o,title:a,description:i}}}).then(function(e){(e.status=200)&&(t.taskId=o,t.taskName=a,t.taskDescription=i,t.showTaskBlock=!0,t.showBlockTask=!1,angular.forEach(t.tasks,function(t,e){t.Task.id==o&&(t.Task.title=a)}))},function(t){})},deleteThisTask=function(s,o){e({method:"DELETE",url:"https://api-test-task.decodeapps.io/tasks/task?session="+s+"&task_id="+o}).then(function(e){(e.status=200)&&(t.closePageTask(),getProjects(s,!0))},function(t){})},t.search=function(){null!=t.searchKeyword&&getTasks(i,t.activeProject,10,0,t.searchKeyword)},t.addProject=function(){createProject(i,t.projectEdit)},t.updateProject=function(){editProject(i,t.activeProject,t.projectEdit)},t.deleteProject=function(){deleteThisProject(i,t.activeProject)},t.openTask=function(e,s,o){t.showTaskBlock=!0,t.bgStyle={opacity:"0.8"},t.taskId=e,t.taskName=s,t.taskDescription=o},t.editTask=function(e,s,o){t.isTaskEdit=!0,t.taskIdEdit=e,t.taskNameAdd=s,t.taskDescriptionAdd=o,t.showTaskBlock=!1,t.showBlockTask=!0,t.bgStyle={opacity:"0.8"}},t.UpdateTask=function(){editThisTask(i,t.taskIdEdit,t.taskNameAdd,t.taskDescriptionAdd)},t.compliteTask=function(t){compliteTask(i,t)},t.deleteTask=function(t){deleteThisTask(i,t)},t.openTasks=function(e,o){var a=s.get("session");t.activeProject=e,t.projectTitle=o,getTasks(a,t.activeProject,10,0,null)},t.addTask=function(){createTask(i,t.activeProject,t.taskNameAdd,t.taskDescriptionAdd)},t.openProjectPage=function(){t.isProjectEdit=!1,t.showBlockEditProjects=!0,t.bgStyle={opacity:"0.8"}},t.closeProjectPage=function(){t.showBlockProjects=!1,t.bgStyle={opacity:"1"}},t.getProjectPageTitle=function(){return t.isProjectEdit?"Edit project":"Create project"},t.openEditProjectPage=function(){t.isProjectEdit=!0,t.projectEdit=t.projectTitle,t.showBlockEditProjects=!0,t.bgStyle={opacity:"0.8"}},t.closeEditProjectPage=function(){t.showBlockEditProjects=!1,t.bgStyle={opacity:"1"}},t.openTaskPage=function(){t.isTaskEdit=!1,t.showBlockTask=!0,t.bgStyle={opacity:"0.8"}},t.closeTaskPage=function(){t.showBlockTask=!1,t.bgStyle={opacity:"1"}},t.closePageTask=function(){t.showTaskBlock=!1,t.bgStyle={opacity:"1"}},t.nextPage=function(){if(!t.busy&&void 0!=t.activeProject){var s=t.page;if(!(s+1>t.taskPageCount)){t.busy=!0,t.page++;var a=10*(t.page-1),c="https://api-test-task.decodeapps.io/tasks?session="+i+"&project_id="+t.activeProject+"&paging_size=10&paging_offset="+a;e({method:"GET",url:c}).then(function(e){e.data.tasks.length>0&&angular.forEach(e.data.tasks,function(e,s){var a,i=o("date")(t.currentDate,"EEEE '('MM.dd.yyyy')'","+0900"),c=o("date")(new Date(e.Task.created_at),"EEEE '('MM.dd.yyyy')'",t.currentTimeZone),n=new Date(t.currentDate.getTime()-864e5),r=o("date")(n,"EEEE '('MM.dd.yyyy')'","+0900");a=i==c?"Today":r==c?"Yesterday":c;var d={Task:{id:e.Task.id,title:e.Task.title,description:e.Task.description,created_at:a}};t.tasks.push(d)}),t.busy=!1},function(t){})}}}}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsImNsaWNrIiwidGhpcyIsIm5leHQiLCJ0b2dnbGUiLCJkb2N1bWVudCIsImUiLCJ0YXJnZXQiLCJpcyIsInBhcmVudHMiLCJoaWRlIiwidGFza1Byb2plY3RBcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRodHRwIiwiJGNvb2tpZXMiLCIkZmlsdGVyIiwidGFza1BhZ2VDb3VudCIsInBhZ2UiLCJidXN5Iiwic2hvd0Jsb2NrUHJvamVjdHMiLCJzaG93QmxvY2tUYXNrIiwic2hvd0Jsb2NrRWRpdFByb2plY3RzIiwiaXNQcm9qZWN0RWRpdCIsImlzVGFza0VkaXQiLCJjdXJyZW50RGF0ZSIsIkRhdGUiLCJjdXJyZW50VGltZVpvbmUiLCJ0b1N0cmluZyIsInNwbGl0Iiwic2xpY2UiLCJhY3RpdmVQcm9qZWN0TmFtZSIsInNlc3Npb25Db29raWVzIiwiZ2V0IiwiYWN0aXZlQ2xhc3MiLCJpZCIsImFjdGl2ZVByb2plY3QiLCJnZXRTZXNzaW9uIiwibWV0aG9kIiwidXJsIiwidGhlbiIsInJlc3BvbnNlIiwicHV0IiwiZGF0YSIsInNlc3Npb24iLCJjaGVja1Nlc3Npb24iLCJzdGF0dXNUZXh0IiwicHJlbG9hZGVyIiwiZGlzcGxheSIsImdldFVzZXIiLCJnZXRQcm9qZWN0cyIsIm5ld1Nlc3Npb25Db29raWVzIiwiaW5pdCIsInVuZGVmaW5lZCIsInVzZXJBdmF0YXIiLCJBY2NvdW50IiwiaW1hZ2VfdXJsIiwibmFtZSIsInVzZXJuYW1lIiwiYWN0aXZlUHJvamVjdFNlbGVjdGVkIiwicHJvamVjdHMiLCJQcm9qZWN0IiwicHJvamVjdFRpdGxlIiwidGl0bGUiLCJnZXRUYXNrcyIsImNyZWF0ZVByb2plY3QiLCJzdGF0dXMiLCJjbG9zZVByb2plY3RQYWdlIiwiY2xvc2VFZGl0UHJvamVjdFBhZ2UiLCJlZGl0UHJvamVjdCIsInByb2plY3RJZCIsImRlbGV0ZVRoaXNQcm9qZWN0IiwicGFnaW5nU2l6ZSIsInBhZ2luZ09mZnNldCIsImNvbmRpdGlvbktleXdvcmRzIiwiTWF0aCIsImNlaWwiLCJ0b3RhbF9jb3VudCIsInRhc2tzIiwidGFza3NDb3VudCIsImxlbmd0aCIsImZvckVhY2giLCJ2YWx1ZSIsImtleSIsImNyZWF0ZWRBdCIsIm5vd0RhdGUiLCJjcmVhdGVEYXRlIiwiVGFzayIsImNyZWF0ZWRfYXQiLCJ5ZXN0ZXJkYXkiLCJnZXRUaW1lIiwieWVzdGVyZGF5RGF0ZSIsInRhc2siLCJkZXNjcmlwdGlvbiIsInB1c2giLCJjb21wbGl0ZVRhc2siLCJ0YXNrSWQiLCJjcmVhdGVUYXNrIiwidGFza1RpdGxlIiwidGFza0Rlc2NyaXB0aW9uIiwidGFza19jb3VudCIsImVkaXRUaGlzVGFzayIsInRhc2tOYW1lIiwic2hvd1Rhc2tCbG9jayIsImRlbGV0ZVRoaXNUYXNrIiwiY2xvc2VQYWdlVGFzayIsInNlYXJjaCIsInNlYXJjaEtleXdvcmQiLCJhZGRQcm9qZWN0IiwicHJvamVjdEVkaXQiLCJ1cGRhdGVQcm9qZWN0IiwiZGVsZXRlUHJvamVjdCIsIm9wZW5UYXNrIiwiYmdTdHlsZSIsIm9wYWNpdHkiLCJlZGl0VGFzayIsInRhc2tJZEVkaXQiLCJ0YXNrTmFtZUFkZCIsInRhc2tEZXNjcmlwdGlvbkFkZCIsIlVwZGF0ZVRhc2siLCJkZWxldGVUYXNrIiwib3BlblRhc2tzIiwiZWxlbUlkIiwiZWxlbVRpdGxlIiwiYWRkVGFzayIsIm9wZW5Qcm9qZWN0UGFnZSIsImdldFByb2plY3RQYWdlVGl0bGUiLCJvcGVuRWRpdFByb2plY3RQYWdlIiwib3BlblRhc2tQYWdlIiwiY2xvc2VUYXNrUGFnZSIsIm5leHRQYWdlIiwib2Zmc2V0Il0sIm1hcHBpbmdzIjoiQUFRQUEsRUFBRSxXQUVEQSxFQUFFLG9CQUFvQkMsTUFBTSxXQUMzQkQsRUFBRUUsTUFBTUMsS0FBSyxhQUFhQyxXQUczQkosRUFBRUssVUFBVUosTUFBTSxTQUFTSyxHQUMxQixHQUFJQyxHQUFTRCxFQUFFQyxNQUNWUCxHQUFFTyxHQUFRQyxHQUFHLHFCQUF3QlIsRUFBRU8sR0FBUUUsVUFBVUQsR0FBRyxxQkFDaEVSLEVBQUUsYUFBYVUsVUFLbEIsSUFBSUMsZ0JBQWlCQyxRQUFRQyxPQUFRLGtCQUFtQixZQUFhLGlCQUFrQixtQkFFdkZGLGdCQUFlRyxXQUFZLG1CQUFvQixTQUFVLFFBQVMsV0FBWSxVQUFXLFNBQVVDLEVBQVFDLEVBQU9DLEVBQVVDLEdBQ3hISCxFQUFPSSxjQUFjLEVBQ3JCSixFQUFPSyxLQUFLLEVBQ1pMLEVBQU9NLE1BQUssRUFDWk4sRUFBT08sbUJBQW9CLEVBQzNCUCxFQUFPUSxlQUFnQixFQUN2QlIsRUFBT1MsdUJBQXdCLEVBQy9CVCxFQUFPUSxlQUFnQixFQUN2QlIsRUFBT1UsZUFBZ0IsRUFDdkJWLEVBQU9XLFlBQWEsRUFDcEJYLEVBQU9ZLFlBQWMsR0FBSUMsTUFDekJiLEVBQU9jLGlCQUFrQixHQUFLRCxPQUFNRSxXQUFXQyxNQUFNLEtBQUssR0FBR0MsTUFBTSxLQUNuRSxJQUNJQyxHQURBQyxFQUFpQmpCLEVBQVNrQixJQUFLLFVBR25DcEIsR0FBT3FCLFlBQWMsU0FBVUMsR0FDM0IsTUFBT0EsS0FBT3RCLEVBQU91QixjQUFnQixTQUFXLElBSXBEQyxXQUFjLFdBQ1Z2QixHQUNJd0IsT0FBUSxPQUNSQyxJQUFLLCtDQUNOQyxLQUFNLFNBQXlCQyxHQUk5QixNQUhBMUIsR0FBUzJCLElBQUssVUFBV0QsRUFBU0UsS0FBS0MsU0FDdkNaLEVBQWlCUyxFQUFTRSxLQUFLQyxRQUMvQkMsZUFDT0osRUFBU0UsS0FBS0MsU0FDdEIsU0FBd0JILE9BTy9CSSxhQUFnQixXQUNaL0IsR0FDSXdCLE9BQVEsTUFDUkMsSUFBSyx1REFBeURQLElBQy9EUSxLQUFNLFNBQTBCQyxHQUMvQixHQUEyQixNQUF2QkEsRUFBU0ssV0FDVGpDLEVBQU9rQyxXQUFhQyxRQUFTLFNBQzdCQyxRQUFTakIsR0FDVGtCLFlBQWFsQixHQUFnQixPQUU3QixDQUNBLEdBQUltQixHQUFvQmQsWUFDeEJZLFNBQVNFLEdBQ1RELFlBQWFsQixHQUFnQixLQUVsQyxTQUF3QlMsT0FPL0I1QixFQUFPdUMsS0FBTyxXQUNWLEdBQUlwQixHQUFpQmpCLEVBQVNrQixJQUFLLFVBQ2JvQixTQUFsQnJCLEVBQ0FLLGFBR0FRLGdCQUtSSSxRQUFXLFNBQVVqQixHQUNqQmxCLEdBQ0l3QixPQUFRLE1BQ1JDLElBQUssdURBQXlEUCxJQUMvRFEsS0FBTSxTQUF5QkMsR0FDOUI1QixFQUFPeUMsV0FBYWIsRUFBU0UsS0FBS1ksUUFBUUMsVUFDMUMzQyxFQUFPNEMsS0FBT2hCLEVBQVNFLEtBQUtZLFFBQVFHLFVBQ3JDLFNBQXdCakIsT0FPL0JTLFlBQWMsU0FBVWxCLEVBQWUyQixHQUNuQzdDLEdBQ0l3QixPQUFRLE1BQ1JDLElBQUssd0RBQTBEUCxJQUNoRVEsS0FBTSxTQUEwQkMsR0FDL0I1QixFQUFPK0MsU0FBV25CLEVBQVNFLEtBQUtpQixTQUMzQkQsSUFDRDlDLEVBQU91QixjQUFnQkssRUFBU0UsS0FBS2lCLFNBQVMsR0FBR0MsUUFBUTFCLEdBQ3pEdEIsRUFBT2lELGFBQWVyQixFQUFTRSxLQUFLaUIsU0FBUyxHQUFHQyxRQUFRRSxPQUU1REMsU0FBVWhDLEVBQWdCbkIsRUFBT3VCLGNBQWUsR0FBSSxFQUFHLE9BQ3hELFNBQXdCSyxPQU8vQndCLGNBQWdCLFNBQVVqQyxFQUFnQjhCLEdBQ3RDaEQsR0FDSXdCLE9BQVEsT0FDUkMsSUFBSyx1REFDTEksTUFDSUMsUUFBV1osRUFDWDZCLFNBQ0lFLE1BQVNELE1BR2xCdEIsS0FBTSxTQUF5QkMsSUFDOUJBLEVBQVN5QixPQUFPLE9BQ2hCaEIsWUFBYWxCLEdBQWdCLEdBQzdCbkIsRUFBT3NELG1CQUNQdEQsRUFBT3VCLGNBQWdCSyxFQUFTRSxLQUFLa0IsUUFBUTFCLEdBQzdDdEIsRUFBT2lELGFBQWVBLEVBQ3RCakQsRUFBT3VELHlCQUVSLFNBQXVCM0IsT0FPOUI0QixZQUFjLFNBQVVyQyxFQUFnQnNDLEVBQVdSLEdBQy9DaEQsR0FDSXdCLE9BQVEsT0FDUkMsSUFBSyx1REFDTEksTUFDSUMsUUFBV1osRUFDWDZCLFNBQ0kxQixHQUFNbUMsRUFDTlAsTUFBU0QsTUFHbEJ0QixLQUFNLFNBQXlCQyxJQUMxQkEsRUFBU0ssV0FBYSxRQUN0QkksWUFBYWxCLEdBQWUsR0FDNUJuQixFQUFPdUIsY0FBZ0JLLEVBQVNFLEtBQUtrQixRQUFRMUIsR0FDN0NKLEVBQW9CVSxFQUFTRSxLQUFLa0IsUUFBUUUsTUFDMUNsRCxFQUFPdUQsdUJBQ1BsQixZQUFhbEIsR0FBZSxHQUM1Qm5CLEVBQU91RCx1QkFDUHZELEVBQU91QixjQUFnQkssRUFBU0UsS0FBS2tCLFFBQVExQixHQUM3Q3RCLEVBQU9rQixrQkFBb0JVLEVBQVNFLEtBQUtrQixRQUFRRSxRQUV0RCxTQUF3QnRCLE9BTy9COEIsa0JBQW9CLFNBQVV2QyxFQUFnQnNDLEdBQzFDeEQsR0FDSXdCLE9BQVEsU0FDUkMsSUFBSyxnRUFBdUVQLEVBQWlCLGVBQWlCc0MsSUFFakg5QixLQUFNLFNBQXlCQyxJQUN4QkEsRUFBU3lCLE9BQVMsTUFDbEJoQixZQUFhbEIsR0FBZ0IsSUFFbEMsU0FBd0JTLE9BTy9CdUIsU0FBVyxTQUFVaEMsRUFBZ0JzQyxFQUFXRSxFQUFZQyxFQUFjQyxHQUN0RSxHQUFJbkMsR0FBTSxxREFBdURQLEVBQWlCLGVBQWlCc0MsRUFBWSxnQkFBa0JFLEVBQWEsa0JBQW9CQyxDQUMzSSxPQUFuQkMsSUFDQW5DLEVBQU1BLEVBQU0sdUJBQXlCbUMsR0FFekM1RCxHQUNJd0IsT0FBUSxNQUNSQyxJQUFLQSxJQUNOQyxLQUFNLFNBQXlCQyxHQUM5QjVCLEVBQU9JLGNBQWdCMEQsS0FBS0MsS0FBS25DLEVBQVNFLEtBQUtrQyxZQUFZLElBQzNEaEUsRUFBT2lFLFNBQ1BqRSxFQUFPa0UsV0FBYXRDLEVBQVNFLEtBQUttQyxNQUFNRSxPQUNmM0IsUUFBckJ4QyxFQUFPa0UsWUFDUHJFLFFBQVF1RSxRQUFTeEMsRUFBU0UsS0FBS21DLE1BQU8sU0FBVUksRUFBT0MsR0FDbkQsR0FHSUMsR0FIQUMsRUFBVXJFLEVBQVMsUUFBUUgsRUFBT1ksWUFBYSx3QkFBeUIsU0FDeEU2RCxFQUFhdEUsRUFBUyxRQUFRLEdBQUlVLE1BQUt3RCxFQUFNSyxLQUFLQyxZQUFhLHdCQUF5QjNFLEVBQU9jLGlCQUMvRjhELEVBQVksR0FBSS9ELE1BQU1iLEVBQU9ZLFlBQVlpRSxVQUFZLE9BRXJEQyxFQUFnQjNFLEVBQVMsUUFBUXlFLEVBQVcsd0JBQXlCLFFBRWpFTCxHQURKQyxHQUFXQyxFQUNLLFFBRVhLLEdBQWlCTCxFQUNWLFlBR0FBLENBRWhCLElBQUlNLElBQ0FMLE1BQ0lwRCxHQUFPK0MsRUFBTUssS0FBS3BELEdBQ2xCNEIsTUFBVW1CLEVBQU1LLEtBQUt4QixNQUNyQjhCLFlBQWdCWCxFQUFNSyxLQUFLTSxZQUMzQkwsV0FBZUosR0FHdkJ2RSxHQUFPaUUsTUFBTWdCLEtBQU1GLEtBRzNCL0UsRUFBT2tDLFdBQWFDLFFBQVUsU0FDL0IsU0FBd0JQLE9BTy9Cc0QsYUFBZSxTQUFVL0QsRUFBZ0JnRSxHQUNyQ2xGLEdBQ0l3QixPQUFRLE9BQ1JDLElBQUssMERBQ0xJLE1BQ0lDLFFBQVlaLEVBQ1p1RCxNQUNJcEQsR0FBTzZELE1BR2hCeEQsS0FBTSxTQUEwQkMsSUFDL0JBLEVBQVN5QixPQUFTLE9BQ2xCRixTQUFVaEMsRUFBZ0JuQixFQUFPdUIsY0FBZSxHQUFJLEVBQUcsTUFDdkRjLFlBQWFsQixHQUFnQixLQUU5QixTQUF3QlMsT0FPL0J3RCxXQUFhLFNBQVVqRSxFQUFnQnNDLEVBQVc0QixFQUFXQyxHQUN6RHJGLEdBQ0l3QixPQUFRLE9BQ1JDLElBQUssaURBQ0xJLE1BQ0lDLFFBQVlaLEVBQ1o2QixTQUNJMUIsR0FBT21DLEdBRVhpQixNQUNJeEIsTUFBVW1DLEVBQ1ZMLFlBQWdCTSxNQUd6QjNELEtBQU0sU0FBMEJDLEdBQy9CLEdBQUlBLEVBQVN5QixPQUFTLElBQUssQ0FDdkIsR0FBSTBCLElBQ0FMLE1BQ0lwRCxHQUFPTSxFQUFTRSxLQUFLNEMsS0FBS3BELEdBQzFCNEIsTUFBVW1DLEVBQ1ZMLFlBQWdCTSxFQUNoQlgsV0FBZSxTQUd2QjNFLEdBQU9pRSxNQUFNZ0IsS0FBTUYsR0FDbkIvRSxFQUFPa0UsV0FBYWxFLEVBQU9pRSxNQUFNRSxPQUNqQ3RFLFFBQVF1RSxRQUFTcEUsRUFBTytDLFNBQVUsU0FBVXNCLEVBQU9DLEdBQzNDRCxFQUFNckIsUUFBUTFCLElBQU10QixFQUFPdUIsZUFDM0I4QyxFQUFNckIsUUFBUXVDLGlCQUkzQixTQUF3QjNELE9BTy9CNEQsYUFBZSxTQUFVckUsRUFBZ0JnRSxFQUFRRSxFQUFXQyxHQUN4RHJGLEdBQ0l3QixPQUFRLE9BQ1JDLElBQUssaURBQ0xJLE1BQ0lDLFFBQVlaLEVBQ1p1RCxNQUNJcEQsR0FBTzZELEVBQ1BqQyxNQUFVbUMsRUFDVkwsWUFBZ0JNLE1BR3pCM0QsS0FBTSxTQUEyQkMsSUFDNUJBLEVBQVN5QixPQUFTLE9BQ2xCckQsRUFBT21GLE9BQVNBLEVBQ2hCbkYsRUFBT3lGLFNBQVdKLEVBQ2xCckYsRUFBT3NGLGdCQUFrQkEsRUFDekJ0RixFQUFPMEYsZUFBZ0IsRUFDdkIxRixFQUFPUSxlQUFnQixFQUN2QlgsUUFBUXVFLFFBQVFwRSxFQUFPaUUsTUFBTyxTQUFVSSxFQUFPQyxHQUN2Q0QsRUFBTUssS0FBS3BELElBQU02RCxJQUNqQmQsRUFBTUssS0FBS3hCLE1BQVFtQyxPQUloQyxTQUF3QnpELE9BTy9CK0QsZUFBaUIsU0FBVXhFLEVBQWdCZ0UsR0FDdkNsRixHQUNJd0IsT0FBUSxTQUNSQyxJQUFLLDBEQUFpRVAsRUFBaUIsWUFBY2dFLElBRXhHeEQsS0FBSyxTQUEwQkMsSUFDeEJBLEVBQVN5QixPQUFTLE9BQ2xCckQsRUFBTzRGLGdCQUNQdkQsWUFBYWxCLEdBQWdCLEtBRWxDLFNBQXdCUyxPQU8vQjVCLEVBQU82RixPQUFTLFdBQ2dCLE1BQXhCN0YsRUFBTzhGLGVBQ1AzQyxTQUFVaEMsRUFBZ0JuQixFQUFPdUIsY0FBZSxHQUFJLEVBQUd2QixFQUFPOEYsZ0JBS3RFOUYsRUFBTytGLFdBQWEsV0FDaEIzQyxjQUFlakMsRUFBZ0JuQixFQUFPZ0csY0FHMUNoRyxFQUFPaUcsY0FBZ0IsV0FDbkJ6QyxZQUFhckMsRUFBZ0JuQixFQUFPdUIsY0FBZXZCLEVBQU9nRyxjQUc5RGhHLEVBQU9rRyxjQUFnQixXQUNuQnhDLGtCQUFtQnZDLEVBQWdCbkIsRUFBT3VCLGdCQUc5Q3ZCLEVBQU9tRyxTQUFXLFNBQVU3RSxFQUFJNEIsRUFBTzhCLEdBQ25DaEYsRUFBTzBGLGVBQWdCLEVBQ3ZCMUYsRUFBT29HLFNBQVdDLFFBQVMsT0FDM0JyRyxFQUFPbUYsT0FBUzdELEVBQ2hCdEIsRUFBT3lGLFNBQVd2QyxFQUNsQmxELEVBQU9zRixnQkFBa0JOLEdBRzdCaEYsRUFBT3NHLFNBQVcsU0FBVWhGLEVBQUk0QixFQUFPOEIsR0FDbkNoRixFQUFPVyxZQUFhLEVBQ3BCWCxFQUFPdUcsV0FBYWpGLEVBQ3BCdEIsRUFBT3dHLFlBQWN0RCxFQUNyQmxELEVBQU95RyxtQkFBcUJ6QixFQUM1QmhGLEVBQU8wRixlQUFnQixFQUN2QjFGLEVBQU9RLGVBQWdCLEVBQ3ZCUixFQUFPb0csU0FBV0MsUUFBUyxRQUcvQnJHLEVBQU8wRyxXQUFhLFdBQ2hCbEIsYUFBY3JFLEVBQWdCbkIsRUFBT3VHLFdBQVl2RyxFQUFPd0csWUFBYXhHLEVBQU95RyxxQkFHaEZ6RyxFQUFPa0YsYUFBZSxTQUFVQyxHQUM1QkQsYUFBYy9ELEVBQWdCZ0UsSUFHbENuRixFQUFPMkcsV0FBYSxTQUFVckYsR0FDMUJxRSxlQUFnQnhFLEVBQWdCRyxJQUdwQ3RCLEVBQU80RyxVQUFZLFNBQVVDLEVBQVFDLEdBQ2pDLEdBQUkzRixHQUFpQmpCLEVBQVNrQixJQUFJLFVBQ2xDcEIsR0FBT3VCLGNBQWdCc0YsRUFDdkI3RyxFQUFPaUQsYUFBZTZELEVBQ3RCM0QsU0FBVWhDLEVBQWdCbkIsRUFBT3VCLGNBQWUsR0FBSSxFQUFHLE9BRzNEdkIsRUFBTytHLFFBQVUsV0FDYjNCLFdBQVlqRSxFQUFnQm5CLEVBQU91QixjQUFldkIsRUFBT3dHLFlBQWF4RyxFQUFPeUcscUJBR2pGekcsRUFBT2dILGdCQUFrQixXQUNyQmhILEVBQU9VLGVBQWdCLEVBQ3ZCVixFQUFPUyx1QkFBd0IsRUFDL0JULEVBQU9vRyxTQUFXQyxRQUFTLFFBRS9CckcsRUFBT3NELGlCQUFtQixXQUN0QnRELEVBQU9PLG1CQUFvQixFQUMzQlAsRUFBT29HLFNBQVdDLFFBQVMsTUFFL0JyRyxFQUFPaUgsb0JBQXNCLFdBQ3pCLE1BQUdqSCxHQUFPVSxjQUNDLGVBRUEsa0JBR2ZWLEVBQU9rSCxvQkFBc0IsV0FDekJsSCxFQUFPVSxlQUFnQixFQUN2QlYsRUFBT2dHLFlBQWNoRyxFQUFPaUQsYUFDNUJqRCxFQUFPUyx1QkFBd0IsRUFDL0JULEVBQU9vRyxTQUFXQyxRQUFTLFFBRS9CckcsRUFBT3VELHFCQUF1QixXQUMxQnZELEVBQU9TLHVCQUF3QixFQUMvQlQsRUFBT29HLFNBQVdDLFFBQVMsTUFHL0JyRyxFQUFPbUgsYUFBZSxXQUNsQm5ILEVBQU9XLFlBQWEsRUFDcEJYLEVBQU9RLGVBQWdCLEVBQ3ZCUixFQUFPb0csU0FBV0MsUUFBUyxRQUUvQnJHLEVBQU9vSCxjQUFnQixXQUNuQnBILEVBQU9RLGVBQWdCLEVBQ3ZCUixFQUFPb0csU0FBV0MsUUFBUyxNQUUvQnJHLEVBQU80RixjQUFnQixXQUNuQjVGLEVBQU8wRixlQUFnQixFQUN2QjFGLEVBQU9vRyxTQUFXQyxRQUFTLE1BSS9CckcsRUFBT3FILFNBQVcsV0FDZCxJQUFJckgsRUFBT00sTUFDY2tDLFFBQXRCeEMsRUFBT3VCLGNBQVYsQ0FDQSxHQUFJbEIsR0FBT0wsRUFBT0ssSUFDbEIsTUFBSUEsRUFBSyxFQUFHTCxFQUFPSSxlQUFuQixDQUNBSixFQUFPTSxNQUFPLEVBQ2ROLEVBQU9LLE1BQ1AsSUFBSWlILEdBQXVCLElBQWZ0SCxFQUFPSyxLQUFLLEdBQ3BCcUIsRUFBTSxxREFBdURQLEVBQWlCLGVBQWlCbkIsRUFBT3VCLGNBQWdCLGlDQUEyQytGLENBQ3JLckgsSUFDSXdCLE9BQVEsTUFDUkMsSUFBS0EsSUFDTkMsS0FBTSxTQUF5QkMsR0FDMUJBLEVBQVNFLEtBQUttQyxNQUFNRSxPQUFTLEdBQzdCdEUsUUFBUXVFLFFBQVN4QyxFQUFTRSxLQUFLbUMsTUFBTyxTQUFVSSxFQUFPQyxHQUNuRCxHQUdJQyxHQUhBQyxFQUFVckUsRUFBUyxRQUFRSCxFQUFPWSxZQUFhLHdCQUF5QixTQUN4RTZELEVBQWF0RSxFQUFTLFFBQVEsR0FBSVUsTUFBS3dELEVBQU1LLEtBQUtDLFlBQWEsd0JBQXlCM0UsRUFBT2MsaUJBQy9GOEQsRUFBWSxHQUFJL0QsTUFBTWIsRUFBT1ksWUFBWWlFLFVBQVksT0FFckRDLEVBQWdCM0UsRUFBUyxRQUFReUUsRUFBVyx3QkFBeUIsUUFFakVMLEdBREpDLEdBQVdDLEVBQ0ssUUFFWEssR0FBaUJMLEVBQ1YsWUFHQUEsQ0FFaEIsSUFBSU0sSUFDQUwsTUFDSXBELEdBQU8rQyxFQUFNSyxLQUFLcEQsR0FDbEI0QixNQUFVbUIsRUFBTUssS0FBS3hCLE1BQ3JCOEIsWUFBZ0JYLEVBQU1LLEtBQUtNLFlBQzNCTCxXQUFlSixHQUd2QnZFLEdBQU9pRSxNQUFNZ0IsS0FBTUYsS0FHM0IvRSxFQUFPTSxNQUFPLEdBRWYsU0FBd0JzQiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICogVGhpcmQgcGFydHlcclxuICovXHJcblxyXG5cclxuLypcclxuICogQ3VzdG9tXHJcbiAqL1xyXG4kKGZ1bmN0aW9uKCkge1xyXG5cdC8vIERyb3Bkb3duIHRvZ2dsZVxyXG5cdCQoJy5kcm9wZG93bi10b2dnbGUnKS5jbGljayhmdW5jdGlvbigpe1xyXG5cdFx0JCh0aGlzKS5uZXh0KCcuZHJvcGRvd24nKS50b2dnbGUoKTtcclxuXHR9KTtcclxuXHJcblx0JChkb2N1bWVudCkuY2xpY2soZnVuY3Rpb24oZSkge1xyXG5cdFx0dmFyIHRhcmdldCA9IGUudGFyZ2V0O1xyXG5cdFx0aWYgKCEkKHRhcmdldCkuaXMoJy5kcm9wZG93bi10b2dnbGUnKSAmJiAhJCh0YXJnZXQpLnBhcmVudHMoKS5pcygnLmRyb3Bkb3duLXRvZ2dsZScpKSB7XHJcblx0XHRcdCQoJy5kcm9wZG93bicpLmhpZGUoKTtcclxuXHRcdH1cclxuXHR9KTtcclxufSk7XHJcblxyXG52YXIgdGFza1Byb2plY3RBcHAgPSBhbmd1bGFyLm1vZHVsZSAoJ3Rhc2tQcm9qZWN0QXBwJywgWyduZ0Nvb2tpZXMnLCAnYW5ndWxhci5maWx0ZXInLCAnaW5maW5pdGUtc2Nyb2xsJ10pO1xyXG5cclxudGFza1Byb2plY3RBcHAuY29udHJvbGxlciAoJ1Rhc2tQcm9qZWN0Q3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRjb29raWVzJywgJyRmaWx0ZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJGNvb2tpZXMsICRmaWx0ZXIpIHtcclxuICAgICRzY29wZS50YXNrUGFnZUNvdW50PTA7XHJcbiAgICAkc2NvcGUucGFnZT0xO1xyXG4gICAgJHNjb3BlLmJ1c3k9ZmFsc2U7XHJcbiAgICAkc2NvcGUuc2hvd0Jsb2NrUHJvamVjdHMgPSBmYWxzZTtcclxuICAgICRzY29wZS5zaG93QmxvY2tUYXNrID0gZmFsc2U7XHJcbiAgICAkc2NvcGUuc2hvd0Jsb2NrRWRpdFByb2plY3RzID0gZmFsc2U7XHJcbiAgICAkc2NvcGUuc2hvd0Jsb2NrVGFzayA9IGZhbHNlO1xyXG4gICAgJHNjb3BlLmlzUHJvamVjdEVkaXQgPSBmYWxzZTtcclxuICAgICRzY29wZS5pc1Rhc2tFZGl0ID0gZmFsc2U7XHJcbiAgICAkc2NvcGUuY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgJHNjb3BlLmN1cnJlbnRUaW1lWm9uZSA9IChuZXcgRGF0ZSkudG9TdHJpbmcoKS5zcGxpdCgnKCcpWzFdLnNsaWNlKDAsIC0xKTtcclxuICAgIHZhciBzZXNzaW9uQ29va2llcyA9ICRjb29raWVzLmdldCAoJ3Nlc3Npb24nKSxcclxuICAgICAgICBhY3RpdmVQcm9qZWN0TmFtZTtcclxuICAgIFxyXG4gICAgJHNjb3BlLmFjdGl2ZUNsYXNzID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIGlkID09PSAkc2NvcGUuYWN0aXZlUHJvamVjdCA/ICdhY3RpdmUnIDogJyc7XHJcbiAgICB9O1xyXG4gICAgXHJcblxyXG4gICAgZ2V0U2Vzc2lvbiAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJGh0dHAgKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3NpZ251cCdcclxuICAgICAgICB9KS50aGVuIChmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgJGNvb2tpZXMucHV0ICgnc2Vzc2lvbicsIHJlc3BvbnNlLmRhdGEuc2Vzc2lvbik7XHJcbiAgICAgICAgICAgIHNlc3Npb25Db29raWVzID0gcmVzcG9uc2UuZGF0YS5zZXNzaW9uO1xyXG4gICAgICAgICAgICBjaGVja1Nlc3Npb24oKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuc2Vzc2lvbjtcclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuIFxyXG4gICAgXHJcbiAgICBjaGVja1Nlc3Npb24gID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vc2Vzc2lvbj9zZXNzaW9uPScgKyBzZXNzaW9uQ29va2llcyxcclxuICAgICAgICB9KS50aGVuIChmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2sgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXNUZXh0ID09IFwiT0tcIil7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJlbG9hZGVyID0ge2Rpc3BsYXk6ICdibG9jayd9O1xyXG4gICAgICAgICAgICAgICAgZ2V0VXNlciAoc2Vzc2lvbkNvb2tpZXMpO1xyXG4gICAgICAgICAgICAgICAgZ2V0UHJvamVjdHMgKHNlc3Npb25Db29raWVzLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgIHZhciBuZXdTZXNzaW9uQ29va2llcyA9IGdldFNlc3Npb24oKTtcclxuICAgICAgICAgICAgICAgIGdldFVzZXIgKG5ld1Nlc3Npb25Db29raWVzKTtcclxuICAgICAgICAgICAgICAgIGdldFByb2plY3RzIChzZXNzaW9uQ29va2llcywgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgLy8gY2FsbGVkIGFzeW5jaHJvbm91c2x5IGlmIGFuIGVycm9yIG9jY3Vyc1xyXG4gICAgICAgICAgICAvLyBvciBzZXJ2ZXIgcmV0dXJucyByZXNwb25zZSB3aXRoIGFuIGVycm9yIHN0YXR1cy5cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIFxyXG4gICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHNlc3Npb25Db29raWVzID0gJGNvb2tpZXMuZ2V0ICgnc2Vzc2lvbicpO1xyXG4gICAgICAgIGlmIChzZXNzaW9uQ29va2llcyA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgZ2V0U2Vzc2lvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICBjaGVja1Nlc3Npb24oKTtcclxuICAgICAgICB9ICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICBnZXRVc2VyICA9IGZ1bmN0aW9uIChzZXNzaW9uQ29va2llcykge1xyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vYWNjb3VudD9zZXNzaW9uPScgKyBzZXNzaW9uQ29va2llcyxcclxuICAgICAgICB9KS50aGVuIChmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJBdmF0YXIgPSByZXNwb25zZS5kYXRhLkFjY291bnQuaW1hZ2VfdXJsO1xyXG4gICAgICAgICAgICAkc2NvcGUubmFtZSA9IHJlc3BvbnNlLmRhdGEuQWNjb3VudC51c2VybmFtZTtcclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgXHJcbiAgICBnZXRQcm9qZWN0cyA9IGZ1bmN0aW9uIChzZXNzaW9uQ29va2llcyxhY3RpdmVQcm9qZWN0U2VsZWN0ZWQpIHtcclxuICAgICAgICAkaHR0cCAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cz9zZXNzaW9uPScgKyBzZXNzaW9uQ29va2llcyxcclxuICAgICAgICB9KS50aGVuIChmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2sgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9qZWN0cyA9IHJlc3BvbnNlLmRhdGEucHJvamVjdHM7XHJcbiAgICAgICAgICAgIGlmICghYWN0aXZlUHJvamVjdFNlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlUHJvamVjdCA9IHJlc3BvbnNlLmRhdGEucHJvamVjdHNbMF0uUHJvamVjdC5pZDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wcm9qZWN0VGl0bGUgPSByZXNwb25zZS5kYXRhLnByb2plY3RzWzBdLlByb2plY3QudGl0bGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZ2V0VGFza3MgKHNlc3Npb25Db29raWVzLCAkc2NvcGUuYWN0aXZlUHJvamVjdCwgMTAsIDAsIG51bGwpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2sgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIC8vIGNhbGxlZCBhc3luY2hyb25vdXNseSBpZiBhbiBlcnJvciBvY2N1cnNcclxuICAgICAgICAgICAgLy8gb3Igc2VydmVyIHJldHVybnMgcmVzcG9uc2Ugd2l0aCBhbiBlcnJvciBzdGF0dXMuXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBcclxuICAgIGNyZWF0ZVByb2plY3QgPSBmdW5jdGlvbiAoc2Vzc2lvbkNvb2tpZXMsIHByb2plY3RUaXRsZSkge1xyXG4gICAgICAgICRodHRwICh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgXCJzZXNzaW9uXCI6IHNlc3Npb25Db29raWVzLFxyXG4gICAgICAgICAgICAgICAgXCJQcm9qZWN0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IHByb2plY3RUaXRsZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkudGhlbiAoZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cz0yMDApIHtcclxuICAgICAgICAgICAgZ2V0UHJvamVjdHMgKHNlc3Npb25Db29raWVzLCB0cnVlKTtcclxuICAgICAgICAgICAgJHNjb3BlLmNsb3NlUHJvamVjdFBhZ2UoKTtcclxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVByb2plY3QgPSByZXNwb25zZS5kYXRhLlByb2plY3QuaWQ7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9qZWN0VGl0bGUgPSBwcm9qZWN0VGl0bGU7XHJcbiAgICAgICAgICAgICRzY29wZS5jbG9zZUVkaXRQcm9qZWN0UGFnZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIGVkaXRQcm9qZWN0ID0gZnVuY3Rpb24gKHNlc3Npb25Db29raWVzLCBwcm9qZWN0SWQsIHByb2plY3RUaXRsZSkge1xyXG4gICAgICAgICRodHRwICh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby9wcm9qZWN0cy9wcm9qZWN0JyxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgXCJzZXNzaW9uXCI6IHNlc3Npb25Db29raWVzLFxyXG4gICAgICAgICAgICAgICAgXCJQcm9qZWN0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICBcImlkXCI6IHByb2plY3RJZCxcclxuICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IHByb2plY3RUaXRsZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkudGhlbiAoZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXNUZXh0ID0gXCJPS1wiKSB7XHJcbiAgICAgICAgICAgICAgICBnZXRQcm9qZWN0cyAoc2Vzc2lvbkNvb2tpZXMsdHJ1ZSlcclxuICAgICAgICAgICAgICAgICRzY29wZS5hY3RpdmVQcm9qZWN0ID0gcmVzcG9uc2UuZGF0YS5Qcm9qZWN0LmlkO1xyXG4gICAgICAgICAgICAgICAgYWN0aXZlUHJvamVjdE5hbWUgPSByZXNwb25zZS5kYXRhLlByb2plY3QudGl0bGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2VFZGl0UHJvamVjdFBhZ2UoKTtcclxuICAgICAgICAgICAgICAgIGdldFByb2plY3RzIChzZXNzaW9uQ29va2llcyx0cnVlKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jbG9zZUVkaXRQcm9qZWN0UGFnZSgpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVByb2plY3QgPSByZXNwb25zZS5kYXRhLlByb2plY3QuaWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlUHJvamVjdE5hbWUgPSByZXNwb25zZS5kYXRhLlByb2plY3QudGl0bGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgXHJcbiAgICBkZWxldGVUaGlzUHJvamVjdCA9IGZ1bmN0aW9uIChzZXNzaW9uQ29va2llcywgcHJvamVjdElkKSB7XHJcbiAgICAgICAgJGh0dHAgKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vcHJvamVjdHMvcHJvamVjdD8nICsgJ3Nlc3Npb249JyArIHNlc3Npb25Db29raWVzICsgJyZwcm9qZWN0X2lkPScgKyBwcm9qZWN0SWQsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbiAoZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPSAyMDApIHtcclxuICAgICAgICAgICAgICAgIGdldFByb2plY3RzIChzZXNzaW9uQ29va2llcywgZmFsc2UpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIGdldFRhc2tzID0gZnVuY3Rpb24gKHNlc3Npb25Db29raWVzLCBwcm9qZWN0SWQsIHBhZ2luZ1NpemUsIHBhZ2luZ09mZnNldCwgY29uZGl0aW9uS2V5d29yZHMpIHtcclxuICAgICAgICB2YXIgdXJsID0gJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzP3Nlc3Npb249JyArIHNlc3Npb25Db29raWVzICsgJyZwcm9qZWN0X2lkPScgKyBwcm9qZWN0SWQgKyAnJnBhZ2luZ19zaXplPScgKyBwYWdpbmdTaXplICsgJyZwYWdpbmdfb2Zmc2V0PScgKyBwYWdpbmdPZmZzZXQ7XHJcbiAgICAgICAgaWYgKGNvbmRpdGlvbktleXdvcmRzIT1udWxsKSB7XHJcbiAgICAgICAgICAgIHVybCA9IHVybCArIFwiJmNvbmRpdGlvbl9rZXl3b3Jkcz1cIiArIGNvbmRpdGlvbktleXdvcmRzO1xyXG4gICAgICAgIH1cclxuICAgICAgICAkaHR0cCAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICB9KS50aGVuIChmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnRhc2tQYWdlQ291bnQgPSBNYXRoLmNlaWwocmVzcG9uc2UuZGF0YS50b3RhbF9jb3VudC8xMCk7XHJcbiAgICAgICAgICAgICRzY29wZS50YXNrcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUudGFza3NDb3VudCA9IHJlc3BvbnNlLmRhdGEudGFza3MubGVuZ3RoO1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnRhc2tzQ291bnQgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2ggKHJlc3BvbnNlLmRhdGEudGFza3MsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vd0RhdGUgPSAkZmlsdGVyICgnZGF0ZScpKCRzY29wZS5jdXJyZW50RGF0ZSwgXCJFRUVFICcoJ01NLmRkLnl5eXknKSdcIiwgXCIrMDkwMFwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlRGF0ZSA9ICRmaWx0ZXIgKCdkYXRlJykobmV3IERhdGUodmFsdWUuVGFzay5jcmVhdGVkX2F0KSwgXCJFRUVFICcoJ01NLmRkLnl5eXknKSdcIiwgJHNjb3BlLmN1cnJlbnRUaW1lWm9uZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHllc3RlcmRheSA9IG5ldyBEYXRlICgkc2NvcGUuY3VycmVudERhdGUuZ2V0VGltZSgpIC0gKDI0KjYwKjYwKjEwMDApKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5ZXN0ZXJkYXlEYXRlID0gJGZpbHRlciAoJ2RhdGUnKSh5ZXN0ZXJkYXksIFwiRUVFRSAnKCdNTS5kZC55eXl5JyknXCIsIFwiKzA5MDBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vd0RhdGUgPT0gY3JlYXRlRGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0ID0gXCJUb2RheVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh5ZXN0ZXJkYXlEYXRlID09IGNyZWF0ZURhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0ID0gXCJZZXN0ZXJkYXlcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdCA9IGNyZWF0ZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXNrID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlRhc2tcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiIDogdmFsdWUuVGFzay5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIiA6IHZhbHVlLlRhc2sudGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCIgOiB2YWx1ZS5UYXNrLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkX2F0XCIgOiBjcmVhdGVkQXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRhc2tzLnB1c2ggKHRhc2spO1xyXG4gICAgICAgICAgICAgICAgfSk7ICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLnByZWxvYWRlciA9IHtkaXNwbGF5IDogJ25vbmUnfTtcclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgXHJcbiAgICBjb21wbGl0ZVRhc2sgPSBmdW5jdGlvbiAoc2Vzc2lvbkNvb2tpZXMsIHRhc2tJZCkge1xyXG4gICAgICAgICRodHRwICh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2FwaS10ZXN0LXRhc2suZGVjb2RlYXBwcy5pby90YXNrcy90YXNrL2NvbXBsaXRlJyxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgXCJzZXNzaW9uXCIgOiBzZXNzaW9uQ29va2llcyxcclxuICAgICAgICAgICAgICAgIFwiVGFza1wiIDoge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIiA6IHRhc2tJZCxcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLnRoZW4gKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayAocmVzcG9uc2UpIHtcclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID0gMjAwKSB7XHJcbiAgICAgICAgICAgIGdldFRhc2tzIChzZXNzaW9uQ29va2llcywgJHNjb3BlLmFjdGl2ZVByb2plY3QsIDEwLCAwLCBudWxsKVxyXG4gICAgICAgICAgICBnZXRQcm9qZWN0cyAoc2Vzc2lvbkNvb2tpZXMsIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIGNyZWF0ZVRhc2sgPSBmdW5jdGlvbiAoc2Vzc2lvbkNvb2tpZXMsIHByb2plY3RJZCwgdGFza1RpdGxlLCB0YXNrRGVzY3JpcHRpb24pIHtcclxuICAgICAgICAkaHR0cCAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3MvdGFzaycsXHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIFwic2Vzc2lvblwiIDogc2Vzc2lvbkNvb2tpZXMsXHJcbiAgICAgICAgICAgICAgICBcIlByb2plY3RcIiA6IHtcclxuICAgICAgICAgICAgICAgICAgICBcImlkXCIgOiBwcm9qZWN0SWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcIlRhc2tcIiA6IHtcclxuICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCIgOiB0YXNrVGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiIDogdGFza0Rlc2NyaXB0aW9uXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KS50aGVuIChmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2sgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPSAyMDEpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0YXNrID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiVGFza1wiIDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImlkXCIgOiByZXNwb25zZS5kYXRhLlRhc2suaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIiA6IHRhc2tUaXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiIDogdGFza0Rlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRfYXRcIiA6IFwiVG9kYXlcIlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGFza3MucHVzaCAodGFzayk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGFza3NDb3VudCA9ICRzY29wZS50YXNrcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2ggKCRzY29wZS5wcm9qZWN0cywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuUHJvamVjdC5pZCA9PSAkc2NvcGUuYWN0aXZlUHJvamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5Qcm9qZWN0LnRhc2tfY291bnQgKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgIH0pO1xyXG4gICAgfTsgXHJcbiAgICBcclxuICAgIFxyXG4gICAgZWRpdFRoaXNUYXNrID0gZnVuY3Rpb24gKHNlc3Npb25Db29raWVzLCB0YXNrSWQsIHRhc2tUaXRsZSwgdGFza0Rlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgJGh0dHAgKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzL3Rhc2snLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBcInNlc3Npb25cIiA6IHNlc3Npb25Db29raWVzLFxyXG4gICAgICAgICAgICAgICAgXCJUYXNrXCIgOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJpZFwiIDogdGFza0lkLFxyXG4gICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIiA6IHRhc2tUaXRsZSxcclxuICAgICAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCIgOiB0YXNrRGVzY3JpcHRpb25cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLnRoZW4gKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFja24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPSAyMDApIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS50YXNrSWQgPSB0YXNrSWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGFza05hbWUgPSB0YXNrVGl0bGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGFza0Rlc2NyaXB0aW9uID0gdGFza0Rlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dUYXNrQmxvY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dCbG9ja1Rhc2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUudGFza3MsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLlRhc2suaWQgPT0gdGFza0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLlRhc2sudGl0bGUgPSB0YXNrVGl0bGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7ICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgLy8gY2FsbGVkIGFzeW5jaHJvbm91c2x5IGlmIGFuIGVycm9yIG9jY3Vyc1xyXG4gICAgICAgICAgICAvLyBvciBzZXJ2ZXIgcmV0dXJucyByZXNwb25zZSB3aXRoIGFuIGVycm9yIHN0YXR1cy5cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIFxyXG4gICAgZGVsZXRlVGhpc1Rhc2sgPSBmdW5jdGlvbiAoc2Vzc2lvbkNvb2tpZXMsIHRhc2tJZCkge1xyXG4gICAgICAgICRodHRwICh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLXRlc3QtdGFzay5kZWNvZGVhcHBzLmlvL3Rhc2tzL3Rhc2s/JyArICdzZXNzaW9uPScgKyBzZXNzaW9uQ29va2llcyArICcmdGFza19pZD0nICsgdGFza0lkLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2VQYWdlVGFzaygpO1xyXG4gICAgICAgICAgICAgICAgZ2V0UHJvamVjdHMgKHNlc3Npb25Db29raWVzLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2sgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIC8vIGNhbGxlZCBhc3luY2hyb25vdXNseSBpZiBhbiBlcnJvciBvY2N1cnNcclxuICAgICAgICAgICAgLy8gb3Igc2VydmVyIHJldHVybnMgcmVzcG9uc2Ugd2l0aCBhbiBlcnJvciBzdGF0dXMuXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgIFxyXG4gICAgXHJcbiAgICAkc2NvcGUuc2VhcmNoID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICgkc2NvcGUuc2VhcmNoS2V5d29yZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGdldFRhc2tzIChzZXNzaW9uQ29va2llcywgJHNjb3BlLmFjdGl2ZVByb2plY3QsIDEwLCAwLCAkc2NvcGUuc2VhcmNoS2V5d29yZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgICRzY29wZS5hZGRQcm9qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNyZWF0ZVByb2plY3QgKHNlc3Npb25Db29raWVzLCAkc2NvcGUucHJvamVjdEVkaXQpO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS51cGRhdGVQcm9qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGVkaXRQcm9qZWN0IChzZXNzaW9uQ29va2llcywgJHNjb3BlLmFjdGl2ZVByb2plY3QsICRzY29wZS5wcm9qZWN0RWRpdCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgICRzY29wZS5kZWxldGVQcm9qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGRlbGV0ZVRoaXNQcm9qZWN0IChzZXNzaW9uQ29va2llcywgJHNjb3BlLmFjdGl2ZVByb2plY3QpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAkc2NvcGUub3BlblRhc2sgPSBmdW5jdGlvbiAoaWQsIHRpdGxlLCBkZXNjcmlwdGlvbikge1xyXG4gICAgICAgICRzY29wZS5zaG93VGFza0Jsb2NrID0gdHJ1ZTtcclxuICAgICAgICAkc2NvcGUuYmdTdHlsZSA9IHtvcGFjaXR5OiAnMC44J307XHJcbiAgICAgICAgJHNjb3BlLnRhc2tJZCA9IGlkO1xyXG4gICAgICAgICRzY29wZS50YXNrTmFtZSA9IHRpdGxlO1xyXG4gICAgICAgICRzY29wZS50YXNrRGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgJHNjb3BlLmVkaXRUYXNrID0gZnVuY3Rpb24gKGlkLCB0aXRsZSwgZGVzY3JpcHRpb24pIHtcclxuICAgICAgICAkc2NvcGUuaXNUYXNrRWRpdCA9IHRydWU7XHJcbiAgICAgICAgJHNjb3BlLnRhc2tJZEVkaXQgPSBpZDtcclxuICAgICAgICAkc2NvcGUudGFza05hbWVBZGQgPSB0aXRsZTtcclxuICAgICAgICAkc2NvcGUudGFza0Rlc2NyaXB0aW9uQWRkID0gZGVzY3JpcHRpb247XHJcbiAgICAgICAgJHNjb3BlLnNob3dUYXNrQmxvY2sgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuc2hvd0Jsb2NrVGFzayA9IHRydWU7XHJcbiAgICAgICAgJHNjb3BlLmJnU3R5bGUgPSB7b3BhY2l0eTogJzAuOCd9O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAkc2NvcGUuVXBkYXRlVGFzayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBlZGl0VGhpc1Rhc2sgKHNlc3Npb25Db29raWVzLCAkc2NvcGUudGFza0lkRWRpdCwgJHNjb3BlLnRhc2tOYW1lQWRkLCAkc2NvcGUudGFza0Rlc2NyaXB0aW9uQWRkKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgJHNjb3BlLmNvbXBsaXRlVGFzayA9IGZ1bmN0aW9uICh0YXNrSWQpIHtcclxuICAgICAgICBjb21wbGl0ZVRhc2sgKHNlc3Npb25Db29raWVzLCB0YXNrSWQpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAkc2NvcGUuZGVsZXRlVGFzayA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIGRlbGV0ZVRoaXNUYXNrIChzZXNzaW9uQ29va2llcywgaWQpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAkc2NvcGUub3BlblRhc2tzID0gZnVuY3Rpb24gKGVsZW1JZCwgZWxlbVRpdGxlKSB7XHJcbiAgICAgICAgdmFyIHNlc3Npb25Db29raWVzID0gJGNvb2tpZXMuZ2V0KCdzZXNzaW9uJyk7XHJcbiAgICAgICAgJHNjb3BlLmFjdGl2ZVByb2plY3QgPSBlbGVtSWQ7XHJcbiAgICAgICAgJHNjb3BlLnByb2plY3RUaXRsZSA9IGVsZW1UaXRsZTtcclxuICAgICAgICBnZXRUYXNrcyAoc2Vzc2lvbkNvb2tpZXMsICRzY29wZS5hY3RpdmVQcm9qZWN0LCAxMCwgMCwgbnVsbCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgICRzY29wZS5hZGRUYXNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNyZWF0ZVRhc2sgKHNlc3Npb25Db29raWVzLCAkc2NvcGUuYWN0aXZlUHJvamVjdCwgJHNjb3BlLnRhc2tOYW1lQWRkLCAkc2NvcGUudGFza0Rlc2NyaXB0aW9uQWRkKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgJHNjb3BlLm9wZW5Qcm9qZWN0UGFnZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc2NvcGUuaXNQcm9qZWN0RWRpdCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5zaG93QmxvY2tFZGl0UHJvamVjdHMgPSB0cnVlO1xyXG4gICAgICAgICRzY29wZS5iZ1N0eWxlID0ge29wYWNpdHk6ICcwLjgnfTtcclxuICAgIH1cclxuICAgICRzY29wZS5jbG9zZVByb2plY3RQYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRzY29wZS5zaG93QmxvY2tQcm9qZWN0cyA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5iZ1N0eWxlID0ge29wYWNpdHk6ICcxJ307XHJcbiAgICB9XHJcbiAgICAkc2NvcGUuZ2V0UHJvamVjdFBhZ2VUaXRsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZigkc2NvcGUuaXNQcm9qZWN0RWRpdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ0VkaXQgcHJvamVjdCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuICdDcmVhdGUgcHJvamVjdCc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgJHNjb3BlLm9wZW5FZGl0UHJvamVjdFBhZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJHNjb3BlLmlzUHJvamVjdEVkaXQgPSB0cnVlO1xyXG4gICAgICAgICRzY29wZS5wcm9qZWN0RWRpdCA9ICRzY29wZS5wcm9qZWN0VGl0bGU7XHJcbiAgICAgICAgJHNjb3BlLnNob3dCbG9ja0VkaXRQcm9qZWN0cyA9IHRydWU7XHJcbiAgICAgICAgJHNjb3BlLmJnU3R5bGUgPSB7b3BhY2l0eTogJzAuOCd9O1xyXG4gICAgfVxyXG4gICAgJHNjb3BlLmNsb3NlRWRpdFByb2plY3RQYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRzY29wZS5zaG93QmxvY2tFZGl0UHJvamVjdHMgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuYmdTdHlsZSA9IHtvcGFjaXR5OiAnMSd9O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAkc2NvcGUub3BlblRhc2tQYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRzY29wZS5pc1Rhc2tFZGl0ID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLnNob3dCbG9ja1Rhc2sgPSB0cnVlO1xyXG4gICAgICAgICRzY29wZS5iZ1N0eWxlID0ge29wYWNpdHk6ICcwLjgnfTtcclxuICAgIH1cclxuICAgICRzY29wZS5jbG9zZVRhc2tQYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRzY29wZS5zaG93QmxvY2tUYXNrID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmJnU3R5bGUgPSB7b3BhY2l0eTogJzEnfTtcclxuICAgIH1cclxuICAgICRzY29wZS5jbG9zZVBhZ2VUYXNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRzY29wZS5zaG93VGFza0Jsb2NrID0gZmFsc2U7XHJcbiAgICAgICAgJHNjb3BlLmJnU3R5bGUgPSB7b3BhY2l0eTogJzEnfTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAkc2NvcGUubmV4dFBhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoJHNjb3BlLmJ1c3kpIHJldHVybjtcclxuICAgICAgICBpZigkc2NvcGUuYWN0aXZlUHJvamVjdD09dW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgdmFyIHBhZ2UgPSAkc2NvcGUucGFnZTtcclxuICAgICAgICBpZigocGFnZSsxKT4kc2NvcGUudGFza1BhZ2VDb3VudCkgcmV0dXJuO1xyXG4gICAgICAgICRzY29wZS5idXN5ID0gdHJ1ZTtcclxuICAgICAgICAkc2NvcGUucGFnZSArKzsgICAgXHJcbiAgICAgICAgdmFyIG9mZnNldD0oJHNjb3BlLnBhZ2UtMSkqMTA7ICAgICAgIFxyXG4gICAgICAgIHZhciB1cmwgPSAnaHR0cHM6Ly9hcGktdGVzdC10YXNrLmRlY29kZWFwcHMuaW8vdGFza3M/c2Vzc2lvbj0nICsgc2Vzc2lvbkNvb2tpZXMgKyAnJnByb2plY3RfaWQ9JyArICRzY29wZS5hY3RpdmVQcm9qZWN0ICsgJyZwYWdpbmdfc2l6ZT0nICsgMTAgKyAnJnBhZ2luZ19vZmZzZXQ9JyArIG9mZnNldDtcclxuICAgICAgICAkaHR0cCAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICB9KS50aGVuIChmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEudGFza3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoIChyZXNwb25zZS5kYXRhLnRhc2tzLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBub3dEYXRlID0gJGZpbHRlciAoJ2RhdGUnKSgkc2NvcGUuY3VycmVudERhdGUsIFwiRUVFRSAnKCdNTS5kZC55eXl5JyknXCIsIFwiKzA5MDBcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZURhdGUgPSAkZmlsdGVyICgnZGF0ZScpKG5ldyBEYXRlKHZhbHVlLlRhc2suY3JlYXRlZF9hdCksIFwiRUVFRSAnKCdNTS5kZC55eXl5JyknXCIsICRzY29wZS5jdXJyZW50VGltZVpvbmUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5ZXN0ZXJkYXkgPSBuZXcgRGF0ZSAoJHNjb3BlLmN1cnJlbnREYXRlLmdldFRpbWUoKSAtICgyNCo2MCo2MCoxMDAwKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeWVzdGVyZGF5RGF0ZSA9ICRmaWx0ZXIgKCdkYXRlJykoeWVzdGVyZGF5LCBcIkVFRUUgJygnTU0uZGQueXl5eScpJ1wiLCBcIiswOTAwXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChub3dEYXRlID09IGNyZWF0ZURhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdCA9IFwiVG9kYXlcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeWVzdGVyZGF5RGF0ZSA9PSBjcmVhdGVEYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdCA9IFwiWWVzdGVyZGF5XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQgPSBjcmVhdGVEYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFzayA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJUYXNrXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIiA6IHZhbHVlLlRhc2suaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCIgOiB2YWx1ZS5UYXNrLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiIDogdmFsdWUuVGFzay5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZF9hdFwiIDogY3JlYXRlZEF0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50YXNrcy5wdXNoICh0YXNrKTtcclxuICAgICAgICAgICAgICAgIH0pOyAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5idXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgLy8gY2FsbGVkIGFzeW5jaHJvbm91c2x5IGlmIGFuIGVycm9yIG9jY3Vyc1xyXG4gICAgICAgICAgICAvLyBvciBzZXJ2ZXIgcmV0dXJucyByZXNwb25zZSB3aXRoIGFuIGVycm9yIHN0YXR1cy5cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG59XSk7Il19
