var taskProjectApp=angular.module("taskProjectApp",["ngCookies","angular.filter","infinite-scroll"]);taskProjectApp.controller("TaskProjectCtrl",["$scope","$http","$cookies","$filter",function(t,e,s,a){t.taskPageCount=0,t.page=1,t.busy=!1,t.showBlockProjects=!1,t.showBlockTask=!1,t.showBlockEditProjects=!1,t.showBlockTask=!1,t.isProjectEdit=!1,t.isTaskEdit=!1,t.currentDate=new Date,t.currentTimeZone=(new Date).toString().split("(")[1].slice(0,-1);var i,o=s.get("session");t.activeClass=function(e){return e===t.activeProject?"active":""},getSession=function(){e({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(t){return s.put("session",t.data.session),o=t.data.session,checkSession(),t.data.session},function(){})},checkSession=function(){e({method:"GET",url:"https://api-test-task.decodeapps.io/session?session="+o}).then(function(e){if("OK"==e.statusText)t.preloader={display:"block"},getUser(o),getProjects(o,!1);else{var s=getSession();getUser(s),getProjects(o,!1)}},function(){})},t.init=function(){var t=s.get("session");void 0==t?getSession():checkSession()},getUser=function(s){e({method:"GET",url:"https://api-test-task.decodeapps.io/account?session="+s}).then(function(e){t.userAvatar=e.data.Account.image_url,t.name=e.data.Account.username},function(){})},getProjects=function(s,a){e({method:"GET",url:"https://api-test-task.decodeapps.io/projects?session="+s}).then(function(e){t.projects=e.data.projects,a||(t.activeProject=e.data.projects[0].Project.id,t.projectTitle=e.data.projects[0].Project.title),getTasks(s,t.activeProject,10,0,null)},function(){})},createProject=function(s,a){e({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:s,Project:{title:a}}}).then(function(e){(e.status=200)&&(getProjects(s,!0),t.closeProjectPage(),t.activeProject=e.data.Project.id,t.projectTitle=a,t.closeEditProjectPage())},function(){})},editProject=function(s,a,o){e({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:s,Project:{id:a,title:o}}}).then(function(e){(e.statusText="OK")&&(getProjects(s,!0),t.activeProject=e.data.Project.id,i=e.data.Project.title,t.closeEditProjectPage(),getProjects(s,!0),t.closeEditProjectPage(),t.activeProject=e.data.Project.id,t.activeProjectName=e.data.Project.title)},function(){})},deleteThisProject=function(t,s){e({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project?session="+t+"&project_id="+s}).then(function(e){(e.status=200)&&getProjects(t,!1)},function(){})},getTasks=function(s,o,i,c,n){var r="https://api-test-task.decodeapps.io/tasks?session="+s+"&project_id="+o+"&paging_size="+i+"&paging_offset="+c;null!=n&&(r=r+"&condition_keywords="+n),e({method:"GET",url:r}).then(function(e){t.taskPageCount=Math.ceil(e.data.total_count/10),t.tasks=[],t.tasksCount=e.data.tasks.length,void 0!=t.tasksCount&&angular.forEach(e.data.tasks,function(e){var n,o=a("date")(t.currentDate,"EEEE '('MM.dd.yyyy')'","+0900"),i=a("date")(new Date(e.Task.created_at),"EEEE '('MM.dd.yyyy')'",t.currentTimeZone),c=new Date(t.currentDate.getTime()-864e5),r=a("date")(c,"EEEE '('MM.dd.yyyy')'","+0900");n=o==i?"Today":r==i?"Yesterday":i;var d={Task:{id:e.Task.id,title:e.Task.title,description:e.Task.description,created_at:n}};t.tasks.push(d)}),t.preloader={display:"none"}},function(){})},compliteTask=function(s,a){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task/complite",data:{session:s,Task:{id:a}}}).then(function(e){(e.status=200)&&(getTasks(s,t.activeProject,10,0,null),getProjects(s,!0))},function(){})},createTask=function(s,a,o,i){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:s,Project:{id:a},Task:{title:o,description:i}}}).then(function(e){if(e.status=201){var s={Task:{id:e.data.Task.id,title:o,description:i,created_at:"Today"}};t.tasks.push(s),t.tasksCount=t.tasks.length,angular.forEach(t.projects,function(e){e.Project.id==t.activeProject&&e.Project.task_count++})}},function(){})},editThisTask=function(s,a,o,i){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:s,Task:{id:a,title:o,description:i}}}).then(function(e){(e.status=200)&&(t.taskId=a,t.taskName=o,t.taskDescription=i,t.showTaskBlock=!0,t.showBlockTask=!1,angular.forEach(t.tasks,function(t){t.Task.id==a&&(t.Task.title=o)}))},function(){})},deleteThisTask=function(s,a){e({method:"DELETE",url:"https://api-test-task.decodeapps.io/tasks/task?session="+s+"&task_id="+a}).then(function(e){(e.status=200)&&(t.closePageTask(),getProjects(s,!0))},function(){})},t.search=function(){null!=t.searchKeyword&&getTasks(o,t.activeProject,10,0,t.searchKeyword)},t.addProject=function(){createProject(o,t.projectEdit)},t.updateProject=function(){editProject(o,t.activeProject,t.projectEdit)},t.deleteProject=function(){deleteThisProject(o,t.activeProject)},t.openTask=function(e,s,a){t.showTaskBlock=!0,t.bgStyle={opacity:"0.8"},t.taskId=e,t.taskName=s,t.taskDescription=a},t.editTask=function(e,s,a){t.isTaskEdit=!0,t.taskIdEdit=e,t.taskNameAdd=s,t.taskDescriptionAdd=a,t.showTaskBlock=!1,t.showBlockTask=!0,t.bgStyle={opacity:"0.8"}},t.UpdateTask=function(){editThisTask(o,t.taskIdEdit,t.taskNameAdd,t.taskDescriptionAdd)},t.compliteTask=function(t){compliteTask(o,t)},t.deleteTask=function(t){deleteThisTask(o,t)},t.openTasks=function(e,a){var o=s.get("session");t.activeProject=e,t.projectTitle=a,getTasks(o,t.activeProject,10,0,null)},t.addTask=function(){createTask(o,t.activeProject,t.taskNameAdd,t.taskDescriptionAdd)},t.openProjectPage=function(){t.isProjectEdit=!1,t.showBlockEditProjects=!0,t.bgStyle={opacity:"0.8"}},t.closeProjectPage=function(){t.showBlockProjects=!1,t.bgStyle={opacity:"1"}},t.getProjectPageTitle=function(){return t.isProjectEdit?"Edit project":"Create project"},t.openEditProjectPage=function(){t.isProjectEdit=!0,t.projectEdit=t.projectTitle,t.showBlockEditProjects=!0,t.bgStyle={opacity:"0.8"}},t.closeEditProjectPage=function(){t.showBlockEditProjects=!1,t.bgStyle={opacity:"1"}},t.openTaskPage=function(){t.isTaskEdit=!1,t.showBlockTask=!0,t.bgStyle={opacity:"0.8"}},t.closeTaskPage=function(){t.showBlockTask=!1,t.bgStyle={opacity:"1"}},t.closePageTask=function(){t.showTaskBlock=!1,t.bgStyle={opacity:"1"}},t.nextPage=function(){if(!t.busy&&void 0!=t.activeProject){var s=t.page;if(!(s+1>t.taskPageCount)){t.busy=!0,t.page++;var i=10*(t.page-1),c="https://api-test-task.decodeapps.io/tasks?session="+o+"&project_id="+t.activeProject+"&paging_size=10&paging_offset="+i;e({method:"GET",url:c}).then(function(e){e.data.tasks.length>0&&angular.forEach(e.data.tasks,function(e){var n,o=a("date")(t.currentDate,"EEEE '('MM.dd.yyyy')'","+0900"),i=a("date")(new Date(e.Task.created_at),"EEEE '('MM.dd.yyyy')'",t.currentTimeZone),c=new Date(t.currentDate.getTime()-864e5),r=a("date")(c,"EEEE '('MM.dd.yyyy')'","+0900");n=o==i?"Today":r==i?"Yesterday":i;var d={Task:{id:e.Task.id,title:e.Task.title,description:e.Task.description,created_at:n}};t.tasks.push(d)}),t.busy=!1},function(){})}}}}]);