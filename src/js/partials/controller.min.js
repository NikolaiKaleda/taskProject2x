var taskProjectApp=angular.module("taskProjectApp",["ngCookies"]);taskProjectApp.controller("TaskProjectCtrl",["$scope","$http","$cookies",function(t,e,s){t.showBlockProjects=!1,t.showBlockTask=!1,t.showBlockEditProjects=!1,t.showBlockTask=!1,t.isProjectEdit=!1,t.isTaskEdit=!1;var a,o=s.get("session");t.activeClass=function(e){return e===t.activeProject?"active":""},getSession=function(){var t;return e({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(e){s.put("session",e.data.session),t=e.data.session},function(){}),t},getUser=function(s){e({method:"GET",url:"https://api-test-task.decodeapps.io/account?session="+s}).then(function(e){t.userAvatar=e.data.Account.image_url,t.name=e.data.Account.username},function(){})},getProjects=function(s,o){e({method:"GET",url:"https://api-test-task.decodeapps.io/projects?session="+s}).then(function(e){t.projects=e.data.projects,o||(t.activeProject=e.data.projects[0].Project.id,t.projectTitle=e.data.projects[0].Project.title),getTasks(s,t.activeProject,20,20,null)},function(){})},createProject=function(s,o){e({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:s,Project:{title:o}}}).then(function(e){(e.status=200)&&(getProjects(s,!0),t.closeProjectPage(),t.activeProject=e.data.Project.id,t.projectTitle=o,t.closeEditProjectPage())},function(){})},editProject=function(s,o,c){e({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:s,Project:{id:o,title:c}}}).then(function(e){(e.statusText="OK")&&(getProjects(s,!1),t.closeEditProjectPage(),t.activeProject=e.data.Project.id,a=e.data.Project.title)},function(){})},deleteThisProject=function(t,s){e({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project?session="+t+"&project_id="+s}).then(function(e){(e.status=200)&&getProjects(t,!1)},function(){})},getTasks=function(s,o,a,c,i){var n="https://api-test-task.decodeapps.io/tasks?session="+s+"&project_id="+o+"&paging_size="+a+"&paging_offset="+c;null!=i&&(n=n+"&condition_keywords="+i),e({method:"GET",url:n}).then(function(e){t.tasks=e.data.tasks,t.tasksCount=e.data.tasks.length,t.preloader={display:"none"}},function(){})},compliteTask=function(s,o){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task/complite",data:{session:s,Task:{id:o}}}).then(function(e){(e.status=200)&&getTasks(s,t.activeProject,20,20,null)},function(){})},createTask=function(s,o,a,c){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:s,Project:{id:o},Task:{title:a,description:c}}}).then(function(e){if(e.status=201){var s={Task:{id:e.data.Task.id,title:a,description:c}};t.tasks.push(s),t.tasksCount=t.tasks.length,angular.forEach(t.projects,function(e){e.Project.id==t.activeProject&&e.Project.task_count++})}},function(){})},editThisTask=function(s,o,a,c){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:s,Task:{id:o,title:a,description:c}}}).then(function(e){(e.status=200)&&(t.taskId=o,t.taskName=a,t.taskDescription=c,t.showTaskBlock=!0,t.showBlockTask=!1,angular.forEach(t.tasks,function(t){t.Task.id==o&&(t.Task.title=a)}))},function(){})},deleteThisTask=function(s,o){e({method:"DELETE",url:"https://api-test-task.decodeapps.io/tasks/task?session="+s+"&task_id="+o}).then(function(e){(e.status=200)&&(t.closePageTask(),getProjects(s,!0))},function(){})},t.search=function(){null!=t.searchKeyword&&getTasks(o,t.activeProject,20,20,t.searchKeyword)},t.init=function(){var o=s.get("session");void 0==o&&getSession(),t.preloader={display:"block"},e({method:"GET",url:"https://api-test-task.decodeapps.io/session?session="+o}).then(function(t){if("OK"==t.statusText)getUser(o),getProjects(o,!1);else{var e=getSession();getUser(e),getProjects(o,!1)}},function(){})},t.addProject=function(){createProject(o,t.projectEdit)},t.openTasks=function(e,o){var a=s.get("session");t.activeProject=e,t.projectTitle=o,getTasks(a,t.activeProject,20,20,null)},t.addTask=function(){createTask(o,t.activeProject,t.taskNameAdd,t.taskDescriptionAdd)},t.compliteTask=function(t){compliteTask(o,t)},t.updateProject=function(){editProject(o,t.activeProject,t.projectEdit)},t.deleteProject=function(){deleteThisProject(o,t.activeProject)},t.openTask=function(e,s,o){t.showTaskBlock=!0,t.bgStyle={opacity:"0.8"},t.taskId=e,t.taskName=s,t.taskDescription=o},t.editTask=function(e,s,o){t.isTaskEdit=!0,t.taskIdEdit=e,t.taskNameAdd=s,t.taskDescriptionAdd=o,t.showTaskBlock=!1,t.showBlockTask=!0,t.bgStyle={opacity:"0.8"}},t.UpdateTask=function(){editThisTask(o,t.taskIdEdit,t.taskNameAdd,t.taskDescriptionAdd)},t.deleteTask=function(t){deleteThisTask(o,t)},t.openProjectPage=function(){t.isProjectEdit=!1,t.showBlockEditProjects=!0,t.bgStyle={opacity:"0.8"}},t.closeProjectPage=function(){t.showBlockProjects=!1,t.bgStyle={opacity:"1"}},t.openTaskPage=function(){t.isTaskEdit=!1,t.showBlockTask=!0,t.bgStyle={opacity:"0.8"}},t.closeTaskPage=function(){t.showBlockTask=!1,t.bgStyle={opacity:"1"}},t.openEditProjectPage=function(){t.isProjectEdit=!0,t.projectEdit=t.projectTitle,t.showBlockEditProjects=!0,t.bgStyle={opacity:"0.8"}},t.closeEditProjectPage=function(){t.showBlockEditProjects=!1,t.bgStyle={opacity:"1"}},t.getProjectPageTitle=function(){return t.isProjectEdit?"Edit project":"Create project"},t.closePageTask=function(){t.showTaskBlock=!1,t.bgStyle={opacity:"1"}}}]);