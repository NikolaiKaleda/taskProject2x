var taskProjectApp=angular.module("taskProjectApp",["ngCookies"]);taskProjectApp.controller("TaskProjectCtrl",["$scope","$http","$cookies",function(t,e,o){t.showBlockProjects=!1,t.showBlockTask=!1,t.showBlockEditProjects=!1,t.showBlockTask=!1,t.isProjectEdit=!1;var c,s=o.get("session");t.activeClass=function(e){return e===t.activeProject?"active":""},getSession=function(){var t;return e({method:"POST",url:"https://api-test-task.decodeapps.io/signup"}).then(function(e){o.put("session",e.data.session),t=e.data.session},function(){}),t},getUser=function(o){e({method:"GET",url:"https://api-test-task.decodeapps.io/account?session="+o}).then(function(e){console.log(e),t.userAvatar=e.data.Account.image_url,t.name=e.data.Account.username},function(){})},getProjects=function(o,s){e({method:"GET",url:"https://api-test-task.decodeapps.io/projects?session="+o}).then(function(e){t.projects=e.data.projects,s||(t.activeProject=e.data.projects[0].Project.id,t.projectTitle=e.data.projects[0].Project.title,console.log("active project"),console.log(t.activeProject),console.log(e)),getTasks(o,t.activeProject,20,20,null)},function(){})},createProject=function(o,s){e({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:o,Project:{title:s}}}).then(function(e){console.log("createProject"),console.log(e),(e.status=200)&&(getProjects(o,!0),t.closeProjectPage(),t.activeProject=e.data.Project.id)},function(){})},editProject=function(o,s,a){e({method:"POST",url:"https://api-test-task.decodeapps.io/projects/project",data:{session:o,Project:{id:s,title:a}}}).then(function(e){console.log("editProject"),console.log(e),(e.statusText="OK")&&(getProjects(o,!1),t.closeEditProjectPage(),t.activeProject=e.data.Project.id,c=e.data.Project.title)},function(){})},deleteThisProject=function(t,o){e({method:"DELETE",url:"https://api-test-task.decodeapps.io/projects/project?session="+t+"&project_id="+o}).then(function(e){(e.status=200)&&getProjects(t,!1),console.log("deleteThisProject"),console.log(e)},function(){})},getTasks=function(o,s,c,a,i){var n="https://api-test-task.decodeapps.io/tasks?session="+o+"&project_id="+s+"&paging_size="+c+"&paging_offset="+a;null!=i&&(n=n+"&condition_keywords="+i),e({method:"GET",url:n}).then(function(e){console.log(e),t.tasks=e.data.tasks,t.tasksCount=e.data.tasks.length,t.preloader={display:"none"}},function(){})},compliteTask=function(o,s){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task/complite",data:{session:o,Task:{id:s}}}).then(function(e){console.log("compliteTask"),console.log(e),(e.status=200)&&getTasks(o,t.activeProject,20,20,null)},function(){})},createTask=function(o,s,c,a){e({method:"POST",url:"https://api-test-task.decodeapps.io/tasks/task",data:{session:o,Project:{id:s},Task:{title:c,description:a}}}).then(function(e){if(console.log("Create tesk"),console.log(e),e.status=201){var o={Task:{id:e.data.Task.id,title:c,description:a}};t.tasks.push(o),t.tasksCount=t.tasks.length}},function(){})},t.search=function(){console.log(t.searchKeyword),null!=t.searchKeyword&&getTasks(s,t.activeProject,20,20,t.searchKeyword)},t.init=function(){var s=o.get("session");void 0==s&&getSession(),t.preloader={display:"block"},e({method:"GET",url:"https://api-test-task.decodeapps.io/session?session="+s}).then(function(t){if("OK"==t.statusText)getUser(s),getProjects(s,!1);else{var e=getSession();getUser(e),getProjects(s,!1)}},function(){})},t.addProject=function(){createProject(s,t.project)},t.openTasks=function(e,s){var c=o.get("session");t.activeProject=e,t.projectTitle=s,getTasks(c,t.activeProject,20,20,null)},t.addTask=function(){createTask(s,t.activeProject,t.taskNameAdd,t.taskDescriptionAdd)},t.compliteTask=function(t){compliteTask(s,t)},t.updateProject=function(){editProject(s,t.activeProject,t.projectEdit)},t.deleteProject=function(){deleteThisProject(s,t.activeProject)},t.openTask=function(){t.showTaskBlock=!0,t.bgStyle={opacity:"0.8"}},t.openProjectPage=function(){t.isProjectEdit=!1,t.showBlockProjects=!0,t.bgStyle={opacity:"0.8"}},t.closeProjectPage=function(){t.showBlockProjects=!1,t.bgStyle={opacity:"1"}},t.openTaskPage=function(){t.showBlockTask=!0,t.bgStyle={opacity:"0.8"}},t.closeTaskPage=function(){t.showBlockTask=!1,t.bgStyle={opacity:"1"}},t.openEditProjectPage=function(){t.isProjectEdit=!0,t.projectEdit=t.projectTitle,t.showBlockEditProjects=!0,t.bgStyle={opacity:"0.8"},console.log(t.isProjectEdit)},t.closeEditProjectPage=function(){t.showBlockEditProjects=!1,t.bgStyle={opacity:"1"}},t.getProjectPageTitle=function(){return t.isProjectEdit?"Edit project":"Create project"},t.closePageTask=function(){t.showTaskBlock=!1,t.bgStyle={opacity:"1"}}}]);